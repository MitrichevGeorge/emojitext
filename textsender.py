import os
import asyncio
from dotenv import load_dotenv
from pyrogram import Client
from pyrogram.enums import MessageEntityType
from pyrogram.types import MessageEntity

load_dotenv()
API_ID = int(os.getenv("API_ID"))
API_HASH = os.getenv("API_HASH")

app = Client("my_userbot", api_id=API_ID, api_hash=API_HASH)

prids = {
    'а': 5197622108535949952,
    'б': 5199793854454202534,
    'в': 5199427188801176651,
    'г': 5199785586642168479,
    'д': 5197286581395816962,
    'е': 5199797307607908627,
    'ё': 5197479438312308798,
    'ж': 5199552202414263222,
    'з': 5199700331541332780,
    'и': 5199557291950507324,
    'й': 5197463937775339374,
    'к': 5199536341100039541,
    'л': 5199624946275352981,
    'м': 5197392117332213267,
    'н': 5197183570900191145,
    'о': 5197160403846598276,
    'п': 5199497286962414953,
    'р': 5197255666221222531,
    'с': 5197319339111383487,
    'т': 5197196189514106271,
    'у': 5197430454210298439,
    'ф': 5199890529873071504,
    'х': 5199840583698384073,
    'ц': 5199564395826415329,
    ' ': 5767180307228792434,

    'a' : 5197622108535949952,
    'b' : 5199427188801176651,
    'c' : 5197319339111383487,
    'd' : 5199749947003535928,
    'e' : 5199797307607908627,
    'f' : 5199939973536580756,
    'g' : 5197701784474255626,
    'h' : 5197183570900191145,
    'i' : 5199612074258368493,
    'j' : 5199791208754350235,
    'k' : 5199536341100039541,
    'l' : 5199948374492616323,
    'm' : 5197392117332213267,
    'n' : 5199794661908054980,
    'o' : 5197160403846598276,
    'p' : 5197255666221222531,
    'q' : 5197562442850273098,
    'r' : 5197651116745066391,
    's' : 5199618263306240387,
    't' : 5197196189514106271,
    'u' : 5199479321114215717,
    'v' : 5199643358800149813,
    'w' : 5199785917354639760,
    'x' : 5199840583698384073,
    'y' : 5199794176576752979,
    'z' : 5199823725951745405,

    '1' : 5199615690620830098,
    '2' : 5199939939176842202,
    '3' : 5199910136398773690,
    '4' : 5197686975427021050,
    '5' : 5199644247858380802,
    '6' : 5199938444528224217,
    '7' : 5199863639082829091,
    '8' : 5197676001785576951,
    '9' : 5197622963234437962,
    '0' : 5199963746180564350,
    ',' : 5199595272346306490,
    '.' : 5199525023861213244,
    '!' : 5197712345798838253,
    '-' : 5199687579783430042,
    '?' : 5197440624692857000,
    ':' : 5197233053218408789,
}

async def send_text(s):
    """Отправляет текст кастомными эмодзи"""
    if not app.is_connected:
        await app.start()
    
    entities = []
    text = ""
    
    for i, char in enumerate(s.lower()):
        if char in prids:
            text += "⭐"
            entities.append(
                MessageEntity(
                    type=MessageEntityType.CUSTOM_EMOJI,
                    offset=i,
                    length=1,
                    custom_emoji_id=prids[char]
                ))
        else:
            text += char
    
    await app.send_message("me", text, entities=entities)

async def main():
    await send_text("привет")

async def stop_app():
    try:
        await app.stop()
    except RuntimeError as e:
        if "attached to a different loop" not in str(e):
            raise

if __name__ == "__main__":
    asyncio.run(main())
